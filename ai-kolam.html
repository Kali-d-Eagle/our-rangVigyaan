<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Kolam - RangVigyaan</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Jost:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">

    <style>
        /* Base styles for this dark page */
        :root { --glow-color: #e52e71; }
        body {
            font-family: 'Jost', sans-serif;
            background-color: #0a0a0a;
            color: #e0e0e0;
            overflow-x: hidden;
            cursor: none; /* Hide default cursor */
        }
        #three-canvas { 
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;
        }
        .content-section { display: block; } /* Show all sections on this page */

        /* Custom cursor styles */
        .cursor-dot {
            position: fixed; top: 0; left: 0; transform: translate(-50%, -50%);
            border-radius: 50%; z-index: 10000; pointer-events: none;
            width: 8px; height: 8px; background-color: var(--glow-color);
            transition: transform 0.2s ease-out;
        }
        .sparkle-trail {
            position: fixed; border-radius: 50%; width: 8px; height: 8px;
            z-index: 9999; pointer-events: none;
        }
        .sparkle-particle {
            position: absolute; width: 10px; height: 10px; border-radius: 50%;
        }

        /* Nav overrides for this page */
        nav {
            background: #6f2e21;
        }
        .nav-link:hover, .nav-icon:hover { 
            color: #fbbe28;
        }
        .nav-link.active {
            color: #fbbe28;
        }
    </style>
</head>

<body class="site-container">
    <div class="cursor-dot"></div>
    <canvas id="three-canvas"></canvas>
    <nav class="sticky top-0 z-50">
        <div class="px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20 relative">
                <a id="ourLogo" href="index.html" class="cursor-pointer">
                    <img src="./ourLogo.jpeg" alt="RangVigyaan">
                </a>
                <div class="hidden md:flex items-center space-x-6 absolute left-1/2 -translate-x-1/2">
                    <!-- <a href="index.html" class="nav-link">Home</a>
                    <a href="ai-kolam.html" class="nav-link active">AI Kolam</a>
                    <a href="shop.html" class="nav-link">Shop</a>
                    <a href="learn.html" class="nav-link">Learn</a>
                    <a href="gallery-3d.html" class="nav-link">Art Hub</a> -->
                </div>
                <div class="flex items-center space-x-4">
                    <button class="nav-icon" id="search-btn" title="Search"><i data-lucide="search"></i></button>
                    <button class="nav-icon" id="account-btn" title="Account"><i data-lucide="user"></i></button>
                    <button class="nav-icon relative" id="wishlist-btn" title="Wishlist">
                        <i data-lucide="heart"></i>
                        <span id="wishlist-counter" class="nav-counter hidden">0</span>
                    </button>
                    <button class="nav-icon relative" id="cart-btn" title="Cart">
                        <i data-lucide="shopping-cart"></i>
                        <span id="cart-counter" class="nav-counter hidden">0</span>
                    </button>
                    <button id="mobile-menu-btn" class="nav-icon md:hidden ml-2">
                        <i data-lucide="menu"></i>
                    </button>
                </div>
            </div>
        </div>
         <div id="mobile-menu" class="hidden md:hidden bg-[#6f2e21] border-t border-gray-700">
            <div class="flex flex-col space-y-2 p-4">
                <!-- <a href="index.html" class="nav-link text-left p-2">Home</a>
                <a href="ai-kolam.html" class="nav-link text-left p-2 active">AI Kolam</a>
                <a href="shop.html" class="nav-link text-left p-2">Shop</a>
                <a href="learn.html" class="nav-link text-left p-2">Learn</a>
                <a href="gallery-3d.html" class="nav-link text-left p-2">Art Hub</a> -->
            </div>
        </div>
    </nav>
    <main class="relative">
        
        <section id="ai-kolam-chat" class="content-section active">
            <div class="flex-grow flex flex-col">
                <main class="gemini-main">
                    <div id="gemini-chat-area" class="gemini-chat-area">
                        <div id="chat-welcome" class="text-center text-gray-400 p-8 max-w-3xl mx-auto">
                            <h2 class="text-5xl md:text-6xl font-bold header-title mb-4" style="font-family: 'DM Serif Display', serif;">AI Kolam Weaver</h2>
                            <p class="text-lg">Describe a design (e.g., "draw a lotus" or "create a diya pattern"), and I'll bring it to life in the canvas below.</p>
                        </div>
                    </div>
                    <div class="gemini-input-area">
                        <div class="gemini-input-bar-wrapper">
                            <div class="gemini-input-bar glass-card flex items-center p-2 gap-2">
                                <button class="gemini-tool-btn" title="Upload Image">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><path fill="#e68904" d="M176.53 19.47c-.53-.004-1.058.014-1.593.03c-.57.017-1.145.055-1.718.094c-15.293 1.038-31.656 9.986-45.282 31.75c-27.477 43.885-28.525 97.68-5.844 136.28c15.093 25.69 40.417 45.188 76.875 51.157a64.1 64.1 0 0 1 5.468-18.593c-11.405-12.327-18.01-26.242-20.25-41.062c-4.746-31.38 8.784-64.32 29.03-95.03c8.494-12.884 9.45-24.52 6.345-34.657c-3.106-10.14-10.73-18.925-20.813-24.25c-6.647-3.51-14.247-5.674-22.22-5.72zm198.064 29.75c-37.07.05-71.842 14.557-94.53 39.31c-21.288 23.225-32.635 55.356-25.377 94.876a65 65 0 0 1 8.344-.562c2.248 0 4.468.118 6.658.344c8.678-17.88 21.282-30.383 36.687-37.782c28.608-13.74 64.078-10.445 99.375-.094c14.806 4.343 26.218 1.85 35-4.093c8.782-5.944 14.928-15.83 17.063-27.032c4.268-22.407-6.07-49.4-45.75-60.032c-12.503-3.35-25.113-4.954-37.47-4.937zM261.688 77.812c-8.663 0-17.195.693-25.5 1.968c-1.764 4.902-4.185 9.803-7.344 14.595c-18.915 28.69-29.82 57.914-26.188 81.938c1.497 9.9 5.29 19.32 12.28 28.062a65.2 65.2 0 0 1 21.908-15.938c-8.33-44.56 3.543-83.07 27.72-110.593c-.962-.017-1.912-.03-2.877-.03zm89.25 77.312c-1.02-.006-2.027.01-3.032.03c-12.502.25-23.856 2.493-33.437 7.095c-10.745 5.16-19.894 13.197-26.658 25.563a65 65 0 0 1 19.188 12.375c23.372-13.382 47.298-19.12 70.094-18.407c13.43.422 26.462 3.095 38.75 7.72c1.19.448 2.356.924 3.53 1.406a165 165 0 0 0-11.312-25.875a72 72 0 0 1-7.562-1.78c-17.39-5.1-34.276-8.04-49.563-8.125zm-247.5 37.438a165.4 165.4 0 0 0-6.75 29.53a69.4 69.4 0 0 1 10.937 10.47c22.13 26.29 47.062 45.03 71.125 48.375c8.972 1.246 18.1.6 27.438-2.657a64.2 64.2 0 0 1-7.063-20.78c-43.162-6.468-74.965-29.445-93.156-60.406a127 127 0 0 1-2.532-4.53zm266.968 7.562c-.9.016-1.813.053-2.72.094c-15.917.71-32.434 5.25-48.998 14.436a64.3 64.3 0 0 1 7.468 18.97c15.995 2.598 29.416 9.17 40.156 19c23.413 21.425 33.575 55.573 37.125 92.186c1.49 15.36 8.058 25.004 16.844 30.938c8.788 5.934 20.25 7.946 31.44 5.75c22.38-4.39 43.58-24.057 38.655-64.844c-6.206-51.403-39.195-93.918-81.094-109.687c-12.274-4.62-25.35-7.09-38.874-6.845zM263.03 201.53c-25.51 0-46 20.49-46 46c0 25.513 20.49 46 46 46c25.513 0 45.97-20.487 45.97-46c0-25.51-20.457-46-45.97-46M61.907 228.657c-10.602.097-21.184 4.94-29.156 13.094c-15.944 16.31-22.248 44.514 4.938 75.313c34.262 38.815 85.546 55.12 129 44.343c27.786-6.89 52.807-24.442 69-55.312a65 65 0 0 1-18.094-12.656c-13.844 6.054-27.785 7.923-41.406 6.03c-31.435-4.367-59.187-26.733-82.875-54.874c-9.937-11.804-20.805-16.034-31.407-15.938M327.47 252.47c-.617 8.075-2.705 15.76-6.033 22.75c31.313 28.636 44.904 64.466 43.344 99.624c0 .03.003.062 0 .094a167.3 167.3 0 0 0 21.345-20.157a72 72 0 0 1-1.28-8.186c-3.318-34.205-13.235-63.786-31.158-80.188c-7.17-6.563-15.722-11.45-26.218-13.937m-16.408 38.25a65.2 65.2 0 0 1-16 12.936c2.4 15.863.274 30.532-5.687 43.688c-13.1 28.91-42.393 49.194-76.094 63.937c-14.135 6.186-21.242 15.4-24.155 25.595c-2.913 10.196-1.31 21.73 4.25 31.688c11.12 19.912 36.415 33.97 73.656 16.625c46.935-21.86 77.08-66.428 79.064-111.157c1.294-29.18-8.88-58.737-35.03-83.31zm-33.592 19.84a64.3 64.3 0 0 1-14.44 1.657c-3.22 0-6.37-.26-9.467-.72c-18.668 37.097-48.75 59.723-82.375 68.063c-1.625.402-3.27.786-4.907 1.125a166.2 166.2 0 0 0 31.814 17.437a72 72 0 0 1 7.72-3.97c31.48-13.772 56.533-32.368 66.56-54.5c3.994-8.81 5.965-18.406 5.095-29.092"/></svg>
                                </button>
                                <textarea id="prompt-input" rows="1" placeholder="e.g., show me a complex pulli kolam" class="flex-grow bg-transparent border-none text-white resize-none p-2 text-base focus:outline-none"></textarea>
                                <button id="send-btn" class="gemini-tool-btn hidden" title="Send"><i data-lucide="arrow-up"></i></button>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </section>

        <section id="ai-kolam-manual" class="content-section active max-w-7xl mx-auto my-12 p-4">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold page-title" style="font-family: 'DM Serif Display', serif;">Or, Weave Manually</h2>
                <p class="text-gray-400">Use the controls to generate your own masterpiece.</p>
            </div>

            <div class="generator-container">
                <div class="generator-controls space-y-6">
                    <div>
                        <label for="pattern-type">1. Select Pattern</label>
                        <select id="pattern-type" class="w-full">
                            <option value="flower">Classic Flower</option>
                            <option value="lotus">Lotus Mandala</option>
                            <option value="diya">Diya Circle</option>
                            <option value="pulli">Sikku Kolam (Interwoven)</option>
                        </select>
                    </div>
                    <div>
                        <label for="complexity-slider">2. Adjust Complexity: <span id="complexity-value" class="font-bold text-white">5</span></label>
                        <input type="range" id="complexity-slider" min="3" max="10" value="5" class="w-full">
                    </div>
                    <button id="generate-btn" class="btn">
                        <i data-lucide="wand-2" class="inline-block mr-2 w-5 h-5"></i>
                        Weave Artwork
                    </button>
                </div>
                
                <div class="w-full aspect-square flex items-center justify-center bg-black/20 rounded-2xl p-4 border border-white/10">
                    <svg id="kolam-svg" width="100%" height="100%" viewBox="0 0 500 500"></svg>
                </div>
            </div>
        </section>

    </main>
    <div id="search-modal" class="modal-overlay">
        <div class="modal-content glass-card !max-w-3xl">
            <div class="card-content-wrapper p-6">
                <div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold page-title">Search Products</h2><button id="search-modal-close" class="icon-btn !text-white !bg-transparent hover:!bg-white/10"><i data-lucide="x"></i></button></div>
                <div class="flex items-center gap-2 p-3 bg-white/10 rounded-lg border border-white/20 focus-within:border-white/50 transition-colors"><i data-lucide="search" class="text-white/50"></i><input type="text" id="search-input" placeholder="Search for dresses, bags, wall art..." class="w-full bg-transparent text-white placeholder:text-white/50 focus:outline-none"></div>
                <div id="search-results-container" class="mt-6 max-h-[50vh] overflow-y-auto flex flex-col gap-4">
                    <p class="text-gray-400 text-center" id="search-placeholder">Start typing to see results...</p>
                </div>
            </div>
        </div>
    </div>
    <div id="account-modal" class="modal-overlay">
        <div class="modal-content glass-card !max-w-lg">
            <div class="card-content-wrapper p-8">
                <div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold page-title" id="account-modal-title">Login</h2><button id="account-modal-close" class="icon-btn !text-white !bg-transparent hover:!bg-white/10"><i data-lucide="x"></i></button></div>
                <form id="login-form" class="flex flex-col gap-4">
                    <div><label for="login-email" class="text-sm font-medium text-gray-300">Email</label><input type="email" id="login-email" class="w-full p-3 mt-1 bg-white/10 text-white rounded-lg border border-white/20 focus:outline-none focus:border-white/50" required></div>
                    <div><label for="login-password" class="text-sm font-medium text-gray-300">Password</label><input type="password" id="login-password" class="w-full p-3 mt-1 bg-white/10 text-white rounded-lg border border-white/20 focus:outline-none focus:border-white/50" required></div>
                    <button type="submit" class="btn mt-4 !py-3 !text-base">Login</button>
                    <p class="text-center text-gray-400 text-sm">No account? <button type="button" id="show-signup-btn" class="font-semibold text-accent-color hover:underline">Sign up</button></p>
                </form>
                <form id="signup-form" class="hidden flex-col gap-4">
                    <div><label for="signup-name" class="text-sm font-medium text-gray-300">Name</label><input type="text" id="signup-name" class="w-full p-3 mt-1 bg-white/10 text-white rounded-lg border border-white/20 focus:outline-none focus:border-white/50" required></div>
                    <div><label for="signup-email" class="text-sm font-medium text-gray-300">Email</label><input type="email" id="signup-email" class="w-full p-3 mt-1 bg-white/10 text-white rounded-lg border border-white/20 focus:outline-none focus:border-white/50" required></div>
                    <div><label for="signup-password" class="text-sm font-medium text-gray-300">Password</label><input type="password" id="signup-password" class="w-full p-3 mt-1 bg-white/10 text-white rounded-lg border border-white/20 focus:outline-none focus:border-white/50" required></div>
                    <button type="submit" class="btn mt-4 !py-3 !text-base">Create Account</button>
                    <p class="text-center text-gray-400 text-sm">Already have an account? <button type="button" id="show-login-btn" class="font-semibold text-accent-color hover:underline">Login</button></p>
                </form>
            </div>
        </div>
    </div>
    <div id="cart-modal" class="modal-overlay">
        <div class="modal-content glass-card">
            <div class="card-content-wrapper p-6">
                <div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold page-title">Your Cart</h2><button id="cart-modal-close" class="icon-btn !text-white !bg-transparent hover:!bg-white/10"><i data-lucide="x"></i></button></div>
                <div id="cart-modal-items" class="flex flex-col gap-4 mb-6"></div>
                <div class="border-t border-white/10 pt-6"><div class="flex justify-between items-center mb-6"><span class="text-xl text-gray-300">Total:</span><span id="cart-modal-total" class="text-3xl font-bold text-white">â‚¹0</span></div><button id="checkout-btn" class="mesmerizing-btn w-full !text-lg">Proceed to Checkout</button></div>
            </div>
        </div>
    </div>
    <div id="wishlist-modal" class="modal-overlay">
        <div class="modal-content glass-card">
            <div class="card-content-wrapper p-6">
                <div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold page-title">Your Wishlist</h2><button id="wishlist-modal-close" class="icon-btn !text-white !bg-transparent hover:!bg-white/10"><i data-lucide="x"></i></button></div>
                <div id="wishlist-modal-items" class="flex flex-col gap-4 mb-6"></div>
            </div>
        </div>
    </div>
    <div id="payment-modal" class="modal-overlay">
        <div class="modal-content glass-card !max-w-lg">
            <div class="card-content-wrapper p-8">
                <div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold page-title">Payment Gateway</h2><button id="payment-modal-close" class="icon-btn !text-white !bg-transparent hover:!bg-white/10"><i data-lucide="x"></i></button></div>
                <p class="text-gray-300 mb-4">This is where the multi-payment gateway would be integrated!</p>
                <p class="text-gray-400 text-sm mb-6">In a real e-commerce site, this button would redirect you to a secure payment processor like Razorpay, Stripe, or PayPal. Since this is a front-end project, we can't process real payments.</p>
                <button id="payment-modal-ok" class="btn w-full">Got it!</button>
            </div>
        </div>
    </div>
    <footer class="site-footer">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                <div>
                    <a href="index.html" class="inline-block mb-4">
                        <img src="./ourLogo.jpeg" alt="RangVigyaan Logo" class="footer-logo">
                    </a>
                    <p class="text-sm text-gray-400 mb-6">
                        Weaving the threads of ancient tradition with the logic of artificial intelligence to create something new.
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="footer-social-link"><i data-lucide="instagram"></i></a>
                        <a href="#" class="footer-social-link"><i data-lucide="facebook"></i></a>
                        <a href="#" class="footer-social-link"><i data-lucide="twitter"></i></a>
                        <a href="#" class="footer-social-link"><i data-lucide="youtube"></i></a>
                    </div>
                </div>
                <div>
                    <h3 class="footer-title">Explore</h3>
                    <ul class="footer-links">
                        <li><a href="ai-kolam.html" class="footer-link">AI Kolam Generator</a></li>
                        <li><a href="shop.html" class="footer-link">Shop AI Art</a></li>
                        <li><a href="art-hub.html" class="footer-link">3D Art Hub</a></li>
                        <li><a href="art-hub.html#gallery-mandala" class="footer-link">Mandala Gallery</a></li>
                        <li><a href="learn.html#diy-kits" class="footer-link">DIY Kits</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="footer-title">About Us</h3>
                    <ul class="footer-links">
                        <li><a href="learn.html#about-us" class="footer-link">Our Story</a></li>
                        <li><a href="learn.html" class="footer-link">The Technology</a></li>
                        <li><a href="learn.html#faq" class="footer-link">FAQ</a></li>
                        <li><a href="learn.html#contact-us" class="footer-link">Contact Us</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="footer-title">Join Our Community</h3>
                    <p class="text-sm text-gray-400 mb-4">Get exclusive updates, new art drops, and a peek behind the code.</p>
                    <form class="flex">
                        <input type="email" placeholder="your.email@example.com" class="w-full px-4 py-2 bg-gray-800/50 text-white border border-white/20 rounded-l-md focus:outline-none focus:border-accent-color">
                        <button type="submit" class="p-3 bg-accent-color text-white rounded-r-md"><i data-lucide="arrow-right"></i></button>
                    </form>
                </div>
            </div>
            <div class="footer-bottom flex flex-col md:flex-row justify-between items-center text-gray-500">
                <p class="text-sm">&copy; 2025 RangVigyaan. All Rights Reserved.</p>
                <div class="flex space-x-4 text-sm">
                    <a href="learn.html#terms" class="footer-link !text-gray-500 hover:!text-white">Terms & Conditions</a>
                    <a href="learn.html#privacy" class="footer-link !text-gray-500 hover:!text-white">Privacy Policy</a>
                </div>
            </div>
        </div>
    </footer>
    

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- [1] GLOBAL ELEMENTS ---
            const VIBRANT_COLORS = ['#ff8a00', '#e52e71', '#8a2be2', '#00bfff', '#32cd32', '#ffdf00'];
            
            // Chatbot elements
            const promptInput = document.getElementById('prompt-input');
            const sendBtn = document.getElementById('send-btn');
            const chatArea = document.getElementById('gemini-chat-area');
            const chatWelcome = document.getElementById('chat-welcome');

            // Manual generator elements
            const manualSvgCanvas = document.getElementById('kolam-svg');
            const generateBtn = document.getElementById('generate-btn');
            const patternSelect = document.getElementById('pattern-type');
            const complexitySlider = document.getElementById('complexity-slider');
            const complexityValue = document.getElementById('complexity-value');
            const manualGeneratorSection = document.getElementById('ai-kolam-manual');

            let isDrawing = false; // Prevents multiple drawings at once

            // --- [2] DRAWING ENGINE (RESTORED TO DOTS-FIRST) ---
            
            async function animateSVGPaths(targetSvg, commands) {
                if (!targetSvg) return;
                targetSvg.innerHTML = ''; // Clear previous drawing
                
                const svgNS = "http://www.w3.org/2000/svg";
                const svg = document.createElementNS(svgNS, 'svg');
                svg.setAttribute('viewBox', '0 0 500 500');
                svg.style.width = '100%';
                svg.style.height = '100%';
                targetSvg.appendChild(svg);
                
                // Separate dots from lines
                const dots = commands.filter(c => c.fill === 'white');
                const lines = commands.filter(c => c.fill !== 'white');

                // 1. Draw dots (fast, staggered)
                for (const c of dots) {
                    const p = document.createElementNS(svgNS, 'path');
                    p.setAttribute('d', c.path);
                    p.setAttribute('fill', c.color);
                    p.setAttribute('stroke', c.color);
                    svg.appendChild(p);
                    p.style.transform = 'scale(0)';
                    p.style.transformOrigin = 'center';
                    p.style.transition = 'transform 0.2s ease-out';
                    await new Promise(r => setTimeout(r, 20)); // Stagger dot drawing
                    p.style.transform = 'scale(1)';
                }

                // Wait for dots to settle
                if (dots.length > 0) {
                    await new Promise(r => setTimeout(r, 500));
                }

                // 2. Draw lines (slowly, one by one)
                for (const c of lines) {
                    const p = document.createElementNS(svgNS, 'path');
                    p.setAttribute('d', c.path);
                    p.setAttribute('fill', c.fill || 'none');
                    p.setAttribute('stroke', c.color);
                    p.setAttribute('stroke-width', c.strokeWidth || 3);
                    p.setAttribute('stroke-linecap', 'round');
                    if(c.transform) p.setAttribute('transform', c.transform);
                    svg.appendChild(p);
                    
                    const len = p.getTotalLength();
                    if (len > 0) {
                        p.style.strokeDasharray = len;
                        p.style.strokeDashoffset = len;
                        await new Promise(res => {
                            p.getBoundingClientRect(); // Trigger reflow
                            // Calculate duration based on length for consistent speed
                            const dur = Math.max(0.5, len / 200); // 200px per second
                            p.style.transition = `stroke-dashoffset ${dur}s ease-in-out`;
                            p.style.strokeDashoffset = '0';
                            setTimeout(res, dur * 1000 + 50); // +50ms buffer
                        });
                    }
                }
            }


            // --- [3] IMPROVED DRAWING ALGORITHMS ---
            
            // (RESTORED) Default flower pattern
            function generateDefaultFlower(complexity) {
                const commands = [];
                const center = 250;
                const petals = complexity + 2; // Use complexity
                const angleStep = (2 * Math.PI) / petals;
                
                // Central circle
                commands.push({ path: `M ${center - 15} ${center} A 15 15 0 1 1 ${center + 15} ${center} A 15 15 0 1 1 ${center - 15} ${center}`, color: '#ffdf00', fill: '#ffdf00' });
                
                // Petals
                for (let i = 0; i < petals; i++) {
                    const angle = i * angleStep;
                    const color = VIBRANT_COLORS[i % VIBRANT_COLORS.length];
                    const p1x = center + 30 * Math.cos(angle);
                    const p1y = center + 30 * Math.sin(angle);
                    const tipX = center + 150 * Math.cos(angle);
                    const tipY = center + 150 * Math.sin(angle);
                    const cp1x = center + 120 * Math.cos(angle - angleStep/2);
                    const cp1y = center + 120 * Math.sin(angle - angleStep/2);
                    const cp2x = center + 120 * Math.cos(angle + angleStep/2);
                    const cp2y = center + 120 * Math.sin(angle + angleStep/2);
                    
                    commands.push({ path: `M ${p1x} ${p1y} C ${cp1x} ${cp1y}, ${tipX} ${tipY}, ${tipX} ${tipY}`, color: color, strokeWidth: 4 });
                    commands.push({ path: `M ${p1x} ${p1y} C ${cp2x} ${cp2y}, ${tipX} ${tipY}, ${tipX} ${tipY}`, color: color, strokeWidth: 4 });
                }
                return commands;
            }

            // IMPROVED: Generates a multi-layered, beautiful lotus
            function generateLotusKolam(complexity) {
                const commands = [];
                const center = 250;
                const petals = complexity + 2; // Use complexity
                const layers = 3;
                const baseRadius = 40;
                const angleStep = (2 * Math.PI) / petals;

                // 1. Draw dots for the base
                for (let i = 0; i < petals; i++) {
                    const angle = i * angleStep;
                    const x = center + baseRadius * Math.cos(angle);
                    const y = center + baseRadius * Math.sin(angle);
                    commands.push({ path: `M ${x-2} ${y} A 2 2 0 1 1 ${x+2} ${y} A 2 2 0 1 1 ${x-2} ${y}`, color: 'white', fill: 'white' });
                }

                // 2. Draw petal layers (lines)
                for (let l = layers; l >= 1; l--) {
                    const radius = baseRadius * l;
                    const petalLength = 70 + l * 20;
                    
                    for (let i = 0; i < petals; i++) {
                        const angle = i * angleStep;
                        const color = VIBRANT_COLORS[(l + i) % VIBRANT_COLORS.length];
                        
                        const tipX = center + (radius + petalLength) * Math.cos(angle + angleStep / 2);
                        const tipY = center + (radius + petalLength) * Math.sin(angle + angleStep / 2);
                        
                        const p1x = center + radius * Math.cos(angle);
                        const p1y = center + radius * Math.sin(angle);
                        const p2x = center + radius * Math.cos(angle + angleStep);
                        const p2y = center + radius * Math.sin(angle + angleStep);

                        commands.push({ path: `M ${p1x} ${p1y} Q ${tipX} ${tipY} ${p2x} ${p2y}`, color: color, strokeWidth: 3 });
                    }
                }
                // 3. Central circle
                commands.push({ path: `M ${center - 15} ${center} A 15 15 0 1 1 ${center + 15} ${center} A 15 15 0 1 1 ${center - 15} ${center}`, color: '#ffdf00', fill: '#ffdf00' });
                return commands;
            }
            
            // IMPROVED: Generates a circle of detailed, glowing diyas
            function generateDiyaKolam(complexity) {
                const commands = [];
                const center = 250;
                const numDiyas = complexity; // Use complexity
                const angleStep = (2 * Math.PI) / numDiyas;
                const circleRadius = 150;

                // 1. Draw dots
                for(let i = 0; i < numDiyas; i++) {
                    const angle = i * angleStep;
                    const x = center + circleRadius * Math.cos(angle);
                    const y = center + circleRadius * Math.sin(angle);
                    commands.push({ path: `M ${x-2} ${y} A 2 2 0 1 1 ${x+2} ${y} A 2 2 0 1 1 ${x-2} ${y}`, color: 'white', fill: 'white' });
                }

                // 2. Draw lines (diyas)
                for(let i = 0; i < numDiyas; i++) {
                    const angle = i * angleStep;
                    const x = center + circleRadius * Math.cos(angle);
                    const y = center + circleRadius * Math.sin(angle);
                    const size = 40;
                    
                    // Base of the diya (arc)
                    const pathBase = `M ${x - size/2} ${y} A ${size/2} ${size/2} 0 0 0 ${x + size/2} ${y}`;
                    commands.push({ path: pathBase, color: VIBRANT_COLORS[i % VIBRANT_COLORS.length], strokeWidth: 3 });
                    
                    // Top line of the diya
                    const pathTop = `M ${x - size/2} ${y} L ${x + size/2} ${y}`;
                    commands.push({ path: pathTop, color: VIBRANT_COLORS[i % VIBRANT_COLORS.length], strokeWidth: 3 });

                    // Flame
                    const flameHeight = size * 0.8;
                    const flameWidth = size * 0.4;
                    const pathFlame = `M ${x} ${y} Q ${x - flameWidth} ${y - flameHeight/2}, ${x} ${y - flameHeight} Q ${x + flameWidth} ${y - flameHeight/2}, ${x} ${y} Z`;
                    commands.push({ path: pathFlame, color: '#ffdf00', fill: 'rgba(255, 223, 0, 0.7)' });
                }
                return commands;
            }
            
            // IMPROVED: Generates a true interwoven Sikku Kolam
            function generatePulliKolam(complexity) {
                const commands = [];
                const center = 250;
                let gridSize = complexity;
                if (gridSize < 3) gridSize = 3;
                // Sikku kolams look best with odd-numbered grids
                if (gridSize % 2 === 0) gridSize++; 
                
                const totalSize = 400;
                const spacing = totalSize / (gridSize - 1);
                
                // 1. Draw the dots (Pulli)
                for (let i = 0; i < gridSize; i++) {
                    for (let j = 0; j < gridSize; j++) {
                        const x = center - totalSize / 2 + i * spacing;
                        const y = center - totalSize / 2 + j * spacing;
                        commands.push({ path: `M ${x-2} ${y} A 2 2 0 1 1 ${x+2} ${y} A 2 2 0 1 1 ${x-2} ${y}`, color: 'white', fill: 'white' });
                    }
                }

                // 2. Draw the interwoven lines (Kambi)
                const halfGrid = Math.floor(gridSize / 2);
                for (let layer = 0; layer < halfGrid; layer++) {
                    const color = VIBRANT_COLORS[layer % VIBRANT_COLORS.length];
                    const offset = layer * spacing;
                    const half = spacing / 2;
                    
                    // Get corner points for this diamond layer
                    const top = { x: center, y: center - totalSize / 2 + offset };
                    const left = { x: center - totalSize / 2 + offset, y: center };
                    const bottom = { x: center, y: center + totalSize / 2 - offset };
                    const right = { x: center + totalSize / 2 - offset, y: center };
                    
                    // Draw the 4 arcs of the diamond
                    commands.push({ path: `M ${top.x} ${top.y} Q ${top.x + half} ${top.y + half}, ${right.x} ${right.y}`, color: color });
                    commands.push({ path: `M ${right.x} ${right.y} Q ${right.x - half} ${right.y + half}, ${bottom.x} ${bottom.y}`, color: color });
                    commands.push({ path: `M ${bottom.x} ${bottom.y} Q ${bottom.x - half} ${bottom.y - half}, ${left.x} ${left.y}`, color: color });
                    commands.push({ path: `M ${left.x} ${left.y} Q ${left.x + half} ${left.y - half}, ${top.x} ${top.y}`, color: color });
                }
                return commands;
            }

            // --- [4] CENTRAL CONTROL FUNCTION ---
            
            async function startDrawing(pattern, complexity) {
                if (isDrawing) return;
                
                isDrawing = true;
                disableControls(true);
                
                let commands = [];
                
                if (pattern === 'lotus') {
                    commands = generateLotusKolam(complexity);
                } else if (pattern === 'diya') {
                    commands = generateDiyaKolam(complexity);
                } else if (pattern === 'pulli') {
                    commands = generatePulliKolam(complexity);
                } else {
                    commands = generateDefaultFlower(complexity);
                }

                await animateSVGPaths(manualSvgCanvas, commands);
            
                isDrawing = false;
                disableControls(false);
            }

            // Helper to disable all controls
            function disableControls(disabled) {
                if(generateBtn) {
                    generateBtn.disabled = disabled;
                    generateBtn.textContent = disabled ? 'Weaving...' : 'Weave Artwork';
                }
                if(sendBtn) {
                    sendBtn.disabled = disabled;
                }
                if(promptInput) promptInput.disabled = disabled;
                if(patternSelect) patternSelect.disabled = disabled;
                if(complexitySlider) complexitySlider.disabled = disabled;
            }

            // --- [5] EVENT LISTENERS ---

            // --- Chatbot Listeners ---
            if (promptInput && sendBtn && chatArea) {
                promptInput.addEventListener('input', () => {
                    if (sendBtn) sendBtn.classList.toggle('hidden', promptInput.value.trim().length === 0);
                });
                sendBtn.addEventListener('click', handlePrompt);
                promptInput.addEventListener('keydown', e => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        handlePrompt();
                    }
                });
            }

            // --- Manual Generator Listeners ---
            if (complexitySlider && complexityValue) {
                complexitySlider.addEventListener('input', () => {
                    complexityValue.textContent = complexitySlider.value;
                });
            }
            if (generateBtn) {
                generateBtn.addEventListener('click', () => {
                    if (!patternSelect || !complexitySlider) return;
                    startDrawing(patternSelect.value, parseInt(complexitySlider.value));
                });
            }

            // --- [6] CHATBOT "SMART" LOGIC ---
            
            async function handlePrompt() {
                const promptText = promptInput.value.trim().toLowerCase();
                if (isDrawing || promptText === '') return;
                
                if (chatWelcome) chatWelcome.style.display = 'none'; // Hide welcome message
                
                addMessageToChat(promptInput.value, 'user');
                const userText = promptInput.value; // Save original case for display
                promptInput.value = '';
                if(sendBtn) sendBtn.classList.add('hidden');
                
                const thinkingMessage = addMessageToChat('...', 'ai', true);
                await new Promise(r => setTimeout(r, 1000)); // Simulate thinking
                
                // --- Simple Keyword Logic ---
                let pattern = 'flower'; // Default
                let responseText = `I'll draw a classic flower pattern for you in the weaver below. You can also try asking for "lotus", "diya", or "pulli".`;
                let complexity = 5; // Default

                if (promptText.includes('lotus')) {
                    pattern = 'lotus';
                    responseText = "A lotus! A beautiful choice. Watch the weaver below.";
                } else if (promptText.includes('diya') || promptText.includes('lamp')) {
                    pattern = 'diya';
                    responseText = "A circle of diyas, coming right up. Check the weaver below!";
                } else if (promptText.includes('pulli') || promptText.includes('sikku') || promptText.includes('interwoven')) {
                    pattern = 'pulli';
                    responseText = "A complex Sikku Kolam! My favorite. See the drawing canvas below.";
                }

                // Update controls
                if(patternSelect) patternSelect.value = pattern;
                if(complexitySlider) complexitySlider.value = complexity;
                if(complexityValue) complexityValue.textContent = complexity;

                // Update chat
                if(thinkingMessage) thinkingMessage.remove();
                addMessageToChat(responseText, 'ai');
                
                // Scroll to the generator
                if(manualGeneratorSection) {
                    manualGeneratorSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                
                // Call the main drawing engine
                startDrawing(pattern, complexity);
            }

            // Helper to add message to chat UI
            function addMessageToChat(content, role, isThinking = false) {
                if (!chatArea) return null;
                const msg = document.createElement('div');
                msg.className = `chat-message ${role}-message`;
                const icon = role === 'user' ? 'pen-square' : 'palette';
                const thinkingHTML = `<div class="flex gap-2 items-center"><div class="w-2 h-2 bg-white rounded-full animate-pulse"></div><div class="w-2 h-2 bg-white rounded-full animate-pulse [animation-delay:0.2s]"></div><div class="w-2 h-2 bg-white rounded-full animate-pulse [animation-delay:0.4s]"></div></div>`;
                const contentHTML = isThinking ? thinkingHTML : `<p>${content}</p>`;
                
                msg.innerHTML = `
                    <div class="chat-avatar"><i data-lucide="${icon}"></i></div>
                    <div class="chat-content w-full">${contentHTML}</div>
                `;
                
                chatArea.appendChild(msg);
                lucide.createIcons({ nodes: [msg] });
                chatArea.scrollTop = chatArea.scrollHeight;
                return msg;
            }

            // --- [7] INITIAL PAGE LOAD ---
            // Draw a default pattern on page load
            startDrawing('flower', 5);
        });
    </script>
</body>
</html>
